<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dodge the Blocks â€” v13.3.8 (Cyber Grid + Galaxy Drift themes)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    :root { --green:#33ff66; --accent:#ff3dac; --line:#33ff66; --scanline:rgba(255,255,255,0.06); }
    html, body { height: 100%; }
    body { margin: 0; background:#1a1a1a; display:flex; justify-content:center; align-items:center; color:#eee; font-family:"Courier New", monospace; }
    canvas { background:#0b0b0b; display:block; border:2px solid #2a2a2a; position:relative; box-shadow:0 0 24px rgba(0,0,0,.6) inset; z-index:10; pointer-events:auto; touch-action:none; transition: background 240ms linear; }
    /* Animated backgrounds per theme */
    @keyframes neonFlow { 0%{background-position:0 0} 100%{background-position:400px 600px} }
    .bg-neon { background: radial-gradient(circle at 20% 20%, rgba(57,255,20,.15), transparent 40%), linear-gradient(135deg, #000 0%, #060606 100%); background-size: 200% 200%; animation: neonFlow 12s linear infinite; }
    @keyframes midnightDrift { 0%{background-position:0 0} 100%{background-position:0 200%} }
    .bg-midnight { background: radial-gradient(ellipse at 50% 10%, rgba(139,211,255,.12), transparent 45%), linear-gradient(180deg, #0a0f1f 0%, #050912 100%); background-size: 120% 200%; animation: midnightDrift 30s linear infinite; }
    @keyframes vaporWave { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .bg-vapor { background: linear-gradient(90deg, #1b1026, #311b45, #1b1026); background-size: 200% 200%; animation: vaporWave 18s ease-in-out infinite; }
    /* Cyber Grid v2: crisp neon grid + scan sweep */
@keyframes cyberParallaxX { 0%{background-position:0 0, 0 0, 0 0;} 100%{background-position:8px 0, 0 8px, 0 0;} }
@keyframes cyberScan { 0%{opacity:.04; transform:translateY(-100%);} 100%{opacity:.12; transform:translateY(100%);} }
.bg-cyber{
  background:
    /* vertical lines */
    repeating-linear-gradient(90deg,
      rgba(39,255,210,.06) 0px, rgba(39,255,210,.06) 1px,
      transparent 1px, transparent 16px),
    /* horizontal lines */
    repeating-linear-gradient(0deg,
      rgba(39,255,210,.06) 0px, rgba(39,255,210,.06) 1px,
      transparent 1px, transparent 16px),
    /* base */
    radial-gradient(120% 80% at 50% 20%, rgba(255,79,216,.08), transparent 60%),
    linear-gradient(180deg, #031b1a 0%, #011111 100%);
  background-size: 16px 16px, 16px 16px, 100% 100%, 100% 100%;
  animation: cyberParallaxX 6s linear infinite;
  position: relative;
  box-shadow: inset 0 0 30px rgba(39,255,210,.12), 0 0 24px rgba(39,255,210,.08);
}
.bg-cyber::after{
  content:""; position:absolute; inset:0;
  background: linear-gradient(180deg, transparent 0%, rgba(39,255,210,.18) 50%, transparent 100%);
  mix-blend-mode: screen; pointer-events:none;
  animation: cyberScan 2.4s linear infinite;
}
    /* Galaxy Drift: starfield parallax-ish shimmer */
    @keyframes starsDrift { 0% { background-position: 0 0, 0 0, 0 0; } 100% { background-position: -200px 600px, -100px 400px, 0 200px; } }
    .bg-galaxy {
      background:
        radial-gradient(2px 2px at 20% 10%, rgba(255,255,255,.8), transparent 60%),
        radial-gradient(1.5px 1.5px at 80% 40%, rgba(173,216,230,.9), transparent 60%),
        radial-gradient(1.8px 1.8px at 50% 80%, rgba(255,255,224,.9), transparent 60%),
        linear-gradient(180deg, #070914 0%, #0a0d1d 100%);
      background-repeat: repeat, repeat, repeat, no-repeat;
      background-size: 400px 600px, 400px 600px, 400px 600px, 100% 100%;
      animation: starsDrift 30s linear infinite;
      box-shadow: inset 0 0 40px rgba(0,0,0,.6);
    }

    .btn { font-family:inherit; font-weight:bold; padding:10px 18px; font-size:16px; cursor:pointer; margin:6px; border:2px solid var(--line); background:transparent; color:var(--green); text-shadow:0 0 6px rgba(51,255,102,.5); pointer-events:auto; transition:box-shadow .15s, background .15s, filter .15s; }
    .btn:hover { background: color-mix(in oklab, currentColor 22%, transparent); box-shadow:0 0 8px color-mix(in oklab, currentColor 35%, transparent); filter:brightness(1.05); }
    .btn-accent { color: var(--accent); text-shadow: 0 0 6px color-mix(in oklab, var(--accent) 60%, transparent); }
    .btn-danger { color:#ff6b6b; text-shadow: 0 0 6px color-mix(in oklab, #ff6b6b 60%, transparent); }
    .btn.active, .btn[aria-pressed="true"] { background: color-mix(in oklab, currentColor 28%, transparent); box-shadow:0 0 14px color-mix(in oklab, currentColor 60%, transparent), inset 0 0 10px color-mix(in oklab, currentColor 25%, transparent); filter:brightness(1.1); }
    #topBar { position:fixed; top:8px; left:8px; right:8px; display:flex; gap:12px; align-items:center; justify-content:space-between; z-index:60; font-size:14px; pointer-events:auto; }
    #userInfo { cursor:pointer; pointer-events:auto; }
    #homeOverlay { position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:56px;
      background: repeating-linear-gradient(0deg,transparent 0px, transparent 2px, var(--scanline) 3px, transparent 4px), radial-gradient(circle at 50% 20%, rgba(255,61,172,.12), transparent 40%), #050505;
      text-align:center; overflow:hidden; z-index:30; pointer-events:auto; transition: background 200ms linear; }
    body.no-scanlines #homeOverlay { background: radial-gradient(circle at 50% 20%, rgba(255,61,172,.12), transparent 40%), #050505; }
    .retro-box { border:3px solid var(--line); box-shadow:0 0 24px rgba(51,255,102,.25), inset 0 0 12px rgba(51,255,102,.1); padding:22px 28px; background:#0c0c0c; }
    .corner { position:absolute; top:88px; right:16px; display:flex; gap:10px; pointer-events:auto; flex-wrap:wrap; max-width:80vw; justify-content:flex-end; z-index:35; }
    .overlay { position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:80; pointer-events:auto; }
    .modal { width:720px; max-width:94vw; max-height:80vh; overflow:auto; background:#121212; border:2px solid var(--line); box-shadow:0 0 20px rgba(51,255,102,.3); border-radius:8px; padding:16px; }
    #errBanner { position:fixed; bottom:8px; left:8px; right:8px; background:#0e0e0e; color:#e3ffee; padding:8px 10px; border:1px solid #2dd562; border-radius:6px; font-size:12px; z-index:100; display:none; white-space:pre-wrap; }
    #restartBtn { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:50; pointer-events:auto; }
    #cheatBar { position:fixed; bottom:60px; left:50%; transform:translateX(-50%); display:none; gap:8px; z-index:90; background:#0e0e0e; padding:8px 10px; border:1px solid #2a2a2a; border-radius:6px; }
    #cheatInput { padding:8px; font-size:14px; border:1px solid #3a3a3a; background:#0b0b0b; color:#fff; }
    #backHomeBtn { display:none; }
    .role-badge { color:#ff3dac; margin-left:4px; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0; }
    input[type="checkbox"] { transform: translateY(1px); }
    input, select { background:#0b0b0b; color:#fff; border:1px solid #3a3a3a; padding:8px; }
    .section { border:1px solid #2a2a2a; padding:10px; border-radius:8px; margin:10px 0; }
    .section h4 { margin:0 0 8px 0; color:#9ad6ad; }
    .hint { font-size:12px; opacity:.8; }
    /* Themes list */
    #themesList { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin-top:8px; }
    .themeCard { border:1px solid var(--line); border-radius:8px; padding:10px; cursor:pointer; }
    .themeCard.locked { opacity:.6; cursor:not-allowed; }
    .themeSwatch { height:60px; border-radius:6px; margin-bottom:8px; border:1px solid #333; }
    .themeCard.active { box-shadow:0 0 14px rgba(51,255,102,.6), inset 0 0 10px rgba(51,255,102,.25); }
  
/* Galaxy Drift v2: vibrant space fantasy */
@keyframes starsDriftA { 0% { background-position: 0 0; } 100% { background-position: -300px 900px; } }
@keyframes starsDriftB { 0% { background-position: 0 0; } 100% { background-position: 200px 600px; } }
@keyframes starsDriftC { 0% { background-position: 0 0; } 100% { background-position: -120px 480px; } }
@keyframes auroraWave { 0% { opacity:.05; transform:translateY(0) scaleY(1); } 50% { opacity:.18; transform:translateY(-6px) scaleY(1.06);} 100% { opacity:.05; transform:translateY(0) scaleY(1);} }
.bg-galaxy2 {
  background:
    /* star layer A (big, pink/blue) */
    radial-gradient(2.2px 2.2px at 12% 18%, rgba(255,145,234,.95), transparent 60%),
    radial-gradient(2.2px 2.2px at 78% 34%, rgba(144,202,249,.95), transparent 60%),
    radial-gradient(2.2px 2.2px at 52% 82%, rgba(255,255,255,.95), transparent 60%),
    /* star layer B (medium, teal/gold) */
    radial-gradient(1.8px 1.8px at 25% 70%, rgba(80,250,210,.95), transparent 60%),
    radial-gradient(1.8px 1.8px at 66% 12%, rgba(255,220,130,.95), transparent 60%),
    /* star layer C (small, dense white) */
    radial-gradient(1.2px 1.2px at 33% 48%, rgba(255,255,255,.9), transparent 55%),
    radial-gradient(1.2px 1.2px at 90% 62%, rgba(255,255,255,.8), transparent 55%),
    radial-gradient(1.2px 1.2px at 8% 88%, rgba(255,255,255,.85), transparent 55%),
    /* base gradient */
    linear-gradient(180deg, #0b0f2a 0%, #20124d 45%, #3a0f52 100%);
  background-repeat: repeat, repeat, repeat, repeat, repeat, repeat, repeat, repeat, no-repeat;
  background-size: 500px 750px, 500px 750px, 500px 750px,
                   450px 650px, 450px 650px,
                   420px 620px, 420px 620px, 420px 620px,
                   100% 100%;
  animation:
    starsDriftA 42s linear infinite,
    starsDriftA 54s linear infinite,
    starsDriftA 60s linear infinite,
    starsDriftB 36s linear infinite,
    starsDriftB 48s linear infinite,
    starsDriftC 30s linear infinite,
    starsDriftC 34s linear infinite,
    starsDriftC 38s linear infinite;
  box-shadow: inset 0 0 50px rgba(0,0,0,.7);
  position: relative;
}
/* Aurora overlay (added in draw via canvas bg class; visualized through CSS pseudo-element) */
.bg-galaxy2::after{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(60% 18% at 50% 55%, rgba(70,255,210,.08), transparent 70%),
    radial-gradient(70% 22% at 50% 58%, rgba(255,120,255,.06), transparent 75%);
  pointer-events:none;
  animation: auroraWave 9s ease-in-out infinite;
}

  
/* Galaxy Drift v3: neon sci-fi nebula (magenta/cyan/indigo), slow parallax stars, shifting aurora */
@keyframes g3parallaxA { 0% { background-position: 0 0; } 100% { background-position: -360px 1080px; } }
@keyframes g3parallaxB { 0% { background-position: 0 0; } 100% { background-position:  240px  720px; } }
@keyframes g3parallaxC { 0% { background-position: 0 0; } 100% { background-position: -160px  640px; } }
@keyframes g3Aurora   { 0% { opacity:.06; filter:hue-rotate(0deg); } 50% { opacity:.18; filter:hue-rotate(30deg);} 100% { opacity:.06; filter:hue-rotate(0deg);} }
.bg-galaxy3 {
  background:
    /* large stars (cyan/fuchsia/white) */
    radial-gradient(2.6px 2.6px at 15% 22%, rgba(115,255,255,.95), transparent 60%),
    radial-gradient(2.6px 2.6px at 78% 38%, rgba(255,120,220,.95), transparent 60%),
    radial-gradient(2.6px 2.6px at 55% 80%, rgba(255,255,255,.95), transparent 60%),
    /* medium stars */
    radial-gradient(1.8px 1.8px at 28% 72%, rgba(115,255,255,.9), transparent 60%),
    radial-gradient(1.8px 1.8px at 66% 16%, rgba(255,120,220,.9), transparent 60%),
    radial-gradient(1.8px 1.8px at 86% 56%, rgba(255,255,255,.85), transparent 60%),
    /* small dense whites */
    radial-gradient(1.2px 1.2px at 34% 48%, rgba(255,255,255,.8), transparent 55%),
    radial-gradient(1.2px 1.2px at 92% 64%, rgba(255,255,255,.75), transparent 55%),
    radial-gradient(1.2px 1.2px at 10% 88%, rgba(255,255,255,.8), transparent 55%),
    /* nebula base gradient (magenta/cyan/indigo) */
    radial-gradient(60% 40% at 30% 30%, rgba(255,80,200,.20), transparent 60%),
    radial-gradient(50% 35% at 70% 50%, rgba(80,255,255,.18), transparent 60%),
    linear-gradient(180deg, #1a0b33 0%, #2b0c52 45%, #0f1e4a 100%);
  background-repeat: repeat, repeat, repeat, repeat, repeat, repeat, repeat, repeat, repeat, no-repeat, no-repeat, no-repeat;
  background-size: 520px 780px, 520px 780px, 520px 780px,
                   480px 720px, 480px 720px, 480px 720px,
                   420px 620px, 420px 620px, 420px 620px,
                   100% 100%, 100% 100%, 100% 100%;
  animation:
    g3parallaxA 46s linear infinite,
    g3parallaxA 60s linear infinite,
    g3parallaxA 70s linear infinite,
    g3parallaxB 38s linear infinite,
    g3parallaxB 52s linear infinite,
    g3parallaxC 34s linear infinite,
    g3parallaxC 40s linear infinite,
    g3parallaxC 44s linear infinite;
  position: relative;
  box-shadow: inset 0 0 55px rgba(0,0,0,.7);
}
.bg-galaxy3::after{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(65% 18% at 50% 58%, rgba(115,255,255,.10), transparent 72%),
    radial-gradient(70% 22% at 50% 60%, rgba(255,120,220,.08), transparent 76%);
  mix-blend-mode: screen;
  pointer-events:none;
  animation: g3Aurora 10s ease-in-out infinite;
}

  
/* App-wide cyber grid for menus when Cyber theme is active */
@keyframes cyberHomeScan { 0%{background-position:0 0,0 0,0 0;} 100%{background-position:0 12px,12px 0,0 0;} }
body.cyber-ui #homeOverlay {
  background:
    repeating-linear-gradient(0deg, rgba(39,255,210,.06) 0 1px, transparent 1px 12px),
    repeating-linear-gradient(90deg, rgba(39,255,210,.06) 0 1px, transparent 1px 12px),
    radial-gradient(60% 30% at 50% 18%, rgba(255,79,216,.10), transparent 65%),
    #041414;
  animation: cyberHomeScan 2.2s linear infinite;
}
body.cyber-ui .retro-box,
body.cyber-ui .modal { box-shadow:0 0 24px rgba(39,255,210,.25), inset 0 0 12px rgba(39,255,210,.10); }
body.cyber-ui .btn { text-shadow:0 0 6px rgba(39,255,210,.5); }

  </style>
</head>
<body>
  <!-- (rest of your file stays exactly the same) -->
</body>
</html>
